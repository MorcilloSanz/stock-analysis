<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>stock-analysis</title>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

	<script src="{{ url_for('static', filename='js/stock.js') }}"></script>
	<script src="{{ url_for('static', filename='js/ticker_chart.js') }}"></script>

	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">

</head>
<body>

	<header></header>
	<nav></nav>

	<div class="container">

		<h1>Selecciona los tickers</h1>

        <div class="controls">
            <select id="tickers" multiple></select>
            <button id="add-btn">Add</button>
            <select id="fav-tickers" multiple></select>
            <button id="run-btn">Run</button>
        </div>
    </div>

	<div class="grid">
		<div class="chart-container"><canvas id="chart0"></canvas></div>
		<div class="chart-container"><canvas id="chart1"></canvas></div>
		<div class="chart-container"><canvas id="chart2"></canvas></div>
		<div class="chart-container"><canvas id="chart3"></canvas></div>
		<div class="chart-container"><canvas id="chart4"></canvas></div>
		<div class="chart-container"><canvas id="chart5"></canvas></div>
	</div>

	<script>
		// Get tickers request
		getTickers().then(tickers => {
			const select = document.getElementById('tickers');

			for (const key in tickers.Ticker) {

				const ticker = tickers.Ticker[key];
				const name = tickers.Name[key];

				const option = document.createElement('option');
				option.value = ticker;
				option.textContent = name + ' (' + ticker + ')';

				select.appendChild(option);
			}
		}).catch(error => {
			console.error('Error fetching tickers:', error);
		});

		// Add tickers to favs button
		document.getElementById('add-btn').addEventListener('click', function() {

			const tickersSelect = document.getElementById('tickers');
			const favTickersSelect = document.getElementById('fav-tickers');

			Array.from(tickersSelect.selectedOptions).forEach(option => {
				const exists = Array.from(favTickersSelect.options).some(favOption => favOption.value === option.value);
				
				if (!exists) {
					const newOption = document.createElement('option');
					newOption.value = option.value;
					newOption.text = option.value;
					favTickersSelect.add(newOption);
				}
			});
		});

		function getFavTickers() {
			const favTickersSelect = document.getElementById('fav-tickers');
			const favTickersArray = [];

			Array.from(favTickersSelect.options).forEach(option => {
				favTickersArray.push(option.value);
			});

			return favTickersArray;
		}

		// Run button
		document.getElementById('run-btn').addEventListener('click', function() {

			let favTickers = getFavTickers();

			// Get data request
			getData(favTickers).then(data => {
				console.log(data);
				generateChart(data, favTickers);
			}).catch(error => {
				console.error('Error fetching data:', error);
			});

			document.querySelector('.container').style.display = 'none';
		});

	</script>
</body>
</html>